<!doctype html>
<html>
    <head>
         <meta charset="utf-8">
         <title>Jogo Flappy Bird</title>
         <style>
             canvas{ /* centralizando o elemento canvas */ 
                 position: absolute;
                 top: 0px;
                 bottom: 0px;
                 left: 0px;
                 right: 0px;
                 margin: auto;
             }
         </style>
    </head>
    <body>
         <script>
             var canvas, ctx, ALTURA, LARGURA, frames= 0, velocidade=6;

             var chao = {
                 y: 550,
                 altura: 50,
                 cor: "#ffdf70",
                  
                 desenha: function(){
                     ctx.fillStyle=this.cor;
                     ctx.fillRect(0, this.y, LARGURA, this.altura);
                 }
             };

            var bloco = {
                 x: 50,
                 y: 0,
                 largura: 50,
                 altura: 50,
                 cor: "#ff4e4e",
                 gravidade: 0.7,
                 velocidade: 0,
                 forcaDoPulo: 15,
                 maxPulo: 0,

                 atualiza: function(){
                     this.velocidade += this.gravidade;
                     this.y += this.velocidade;
                    
                     if(this.y > chao.y - this.altura){
                       this.y = chao.y - this.altura;    
                       this.maxPulo=0; 
                    }
                 },
                  
                 desenha: function(){
                     ctx.fillStyle=this.cor;
                     ctx.fillRect(this.x, this.y, this.largura, this.altura);
                 },

                 pula: function(){
                    this.velocidade = -this.forcaDoPulo;
                 }
            };

            var obstaculos = {
                 cores: ["#ffbc1c","#ff1c1c","#ff85e1","#52a7ff","#78ff5d"],
                 obj: [],
                 //tempo: ,
                // x: 500,
                 //y: 300,
                 // largura: 50,
                 // altura: 300-chao.altura,
                 inserir: function(){
                   this.obj.push({  //trecho de programação funcional, isto é, a fração 'push' recebe um objeto enquanto é chamada!
                     x: LARGURA,
                     largura: 30+Math.floor(21*Math.random()),
                     altura: 30+Math.floor(121*Math.random()),
                     cor: this.cores[Math.floor(Math.random()*5)]
                   }); 
                 },  

                 atualiza: function(){
                 	 for(var i=0, tam=this.obj.length;i<tam;i++){
                        var obs = this.obj[i];
                        obs.x -= velocidade;
                        if(obs.x == -obs.largura){
                           obs.splice(i, 1);
                           tam--;
                           i--;
                        }
                    }
                 }, 
      
                 desenha: function(){
                  for(var i=0, tam=this.obj.length;i<tam;i++){
                        var obs = this.obj[i];
                        ctx.fillStyle=obs.cor;
                        ctx.fillRect(obs.x, 550-obs.altura, obs.largura, obs.altura);
                    }
                 }
             }; 
             
             function main(){
                  ALTURA = window.innerHeight;
                  LARGURA = window.innerWidth;

                  if(LARGURA>=500){
                      LARGURA=600;
                      ALTURA=600;
                  }
                
                canvas = document.createElement("canvas"); //criando elemento/objeto 'canvas'
                canvas.width = LARGURA;
                canvas.height = ALTURA;
                canvas.style.border="1px solid black";
                
                ctx=canvas.getContext("2d"); //adicionando o contexto do elemento, que será em 2D
                document.body.appendChild(canvas); //adicionando objeto/elemento ao documento HTML, sendo visivel ao CSS
                document.addEventListener("mousedown", clique);
                /*o eventListener foi adicionado ao documento para executar o evento/funçao 'mousedown', 
                  em que este só é ativado quando o cliente der um clique. caso isso ocorra, o eventListener  
                  'mousedown' chama a função 'clique' passando um objeto do evento 'mousedown'*/
                
                roda();
             }

             function roda(){
             	 //setInterval(()=>{obstaculos.inserirNovo();},1000);
                 atualiza();
                 desenha();

                 //insertTimeout();
                 
                 window.requestAnimationFrame(roda);
                 /*a função acima chama a própria função 'roda()' continuamente.
                 Ela se assemelha a setInterval(), sendo que essa já está obsoleta.*/
             } 
             
             function atualiza(){
                 frames++;
                 bloco.atualiza();
                 obstaculos.atualiza();
                 //setInterval(()=>{obstaculos.atualiza();},2000 ); 
                  
             }

             function desenha(){
                 ctx.fillStyle="#50beff"; //ctx é um objeto retornado da função getContext("2d")
                 ctx.fillRect(0,0, LARGURA, ALTURA); //o preechimento será do canto superior esquerdo(0,0) ao inferior direito(600px, 600px)
                 chao.desenha();
                 //setInterval(()=>{obstaculos.desenha();},2000 ); 
                 obstaculos.desenha();
                 bloco.desenha();
             }
            
             function clique(evt){
                 if(bloco.maxPulo<3){
                   bloco.pula();
                 bloco.maxPulo++; }
             }
 
             main();
              /* var cont=1;
	             function mudarCor(cor){
	             var element = cor;
	             var iniciar = setInterval(vai(),300);	   
	            }
	            function vai(){
	              cont++;
		          element.style.background = "rgb("+cont+","+cont+","+cont+")";
		 
		        if(cont==255){
		 	      alert("rodando");
                  clearInterval(iniciar);
		        }} */
         </script>
    </body>
</html>